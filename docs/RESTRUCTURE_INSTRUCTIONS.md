# Инструкция по реорганизации структуры проекта

## Шаг 1: Запуск скрипта реорганизации

```bash
python restructure_project.py
```

Скрипт автоматически:
- Создаст новую структуру папок
- Переместит все файлы
- Обновит импорты в большинстве файлов

## Шаг 2: Ручная проверка и исправление

### 2.1. Обновить app/main.py

Убедитесь, что импорты правильные:

```python
from app.api.v1.endpoints import (
    auth_router,
    users_router,
    astrology_router,
    contacts_router,
    ai_router,
    context_router,
    natal_chart_router,
    geocoding_router,
    guest_router,
    general_router
)
```

### 2.2. Обновить пути в workers

В `app/workers/run_context_worker.py` и `app/workers/run_sqlite_worker.py` нужно обновить пути:

```python
# Старый путь:
sys.path.insert(0, os.path.dirname(__file__))

# Новый путь:
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.dirname(__file__))))
```

### 2.3. Обновить пути в скриптах

Скрипты в `scripts/` могут требовать обновления путей к модулям.

### 2.4. Обновить pytest.ini

Если используется pytest, обновить пути:

```ini
[pytest]
pythonpath = .
testpaths = tests
```

### 2.5. Обновить alembic.ini (если нужно)

Путь к моделям уже обновлен в `alembic/env.py`, но проверьте.

## Шаг 3: Тестирование

### 3.1. Проверить импорты

```bash
python -c "from app.main import app; print('✅ Импорты работают')"
```

### 3.2. Запустить приложение

```bash
python run.py
```

Или:

```bash
uvicorn app.main:app --reload
```

### 3.3. Запустить worker

```bash
python app/workers/run_context_worker.py
```

## Шаг 4: Обновление зависимостей (опционально)

После реорганизации, обновите файлы, которые могут ссылаться на старые пути:

- `.gitignore` - проверить, что все нужные папки игнорируются
- `.env.example` - если есть примеры путей
- `README.md` - обновить инструкции по запуску

## Шаг 5: Очистка (после успешного тестирования)

После проверки работы приложения можно удалить старые файлы:

```bash
# Осторожно! Удаляет старые файлы
# Убедитесь, что все работает перед удалением

rm -rf routers/
rm -rf database/
rm -rf schemas/
# services/ можно оставить для резерва
```

## Потенциальные проблемы и решения

### Проблема: ImportError после реорганизации

**Решение**: Проверьте, что все пути к модулям обновлены. Используйте абсолютные импорты с префиксом `app.`

### Проблема: Worker не находит модули

**Решение**: Обновите `sys.path.insert()` в worker файлах для правильного указания корневой директории проекта.

### Проблема: Alembic не находит модели

**Решение**: Проверьте `alembic/env.py` - пути должны быть обновлены на `app.models.database.models`.

## Откат изменений (если что-то пошло не так)

Если нужно откатить изменения:

```bash
git checkout .  # Если используете git
# Или восстановить из бэкапа
```

## Структура после реорганизации

```
app/
├── main.py              # Точка входа
├── api/v1/endpoints/    # Роутеры
├── core/                # Конфигурация и БД
├── models/              # Модели и схемы
├── services/            # Бизнес-логика
└── workers/             # Фоновые задачи

scripts/                 # Утилиты
docs/                    # Документация
tests/                   # Тесты
static/                  # Статика
data/                    # Данные
```

## Преимущества новой структуры

✅ **Четкое разделение** - каждый компонент в своей папке  
✅ **Масштабируемость** - легко добавлять новые версии API  
✅ **Стандартность** - следует best practices FastAPI  
✅ **Чистота** - корневая папка содержит только важные файлы  
