# Структура API документации

## Обзор

API документация в Swagger UI (`/docs`) организована по логическим группам для удобной навигации.

## Группы endpoints

### 1. General
**Общие сервисные эндпоинты**

- `GET /` - Проверка работы API
- `GET /health` - Проверка состояния сервиса и БД
- Отладочные endpoints (debug)

### 2. Пользователь
**Управление пользователями: регистрация, аутентификация, профиль**

#### Аутентификация:
- `POST /register` - Регистрация нового пользователя
- `POST /login` - Вход в систему
- `POST /verify-phone` - Подтверждение телефона
- `POST /resend-code` - Повторная отправка кода
- `POST /refresh-token` - Обновление токена

#### Профиль пользователя:
- `GET /users/me` - Получить профиль текущего пользователя
- `PUT /users/me` - Обновить профиль
- `PATCH /users/me/profile` - Обновить расширенный профиль
- `GET /users` - Список пользователей (админ)
- `GET /users/{user_id}` - Получить пользователя по ID

### 3. Контакты
**Управление контактами: создание, редактирование, список контактов**

#### Базовые endpoints:
- `POST /contacts` - Создать контакт
- `GET /users/{user_id}/contacts` - Список контактов пользователя

#### Расширенные endpoints (регистры):
- `POST /registers/contacts` - Создать контакт в регистре
- `GET /registers/contacts` - Список контактов из регистра
- `GET /registers/contacts/{contact_id}` - Получить контакт
- `PUT /registers/contacts/{contact_id}` - Обновить контакт
- `DELETE /registers/contacts/{contact_id}` - Удалить контакт

### 4. Астрологические метрики
**Астрологические расчеты: натальные карты, транзиты, календари**

#### Натальные карты:
- `POST /api/calculate-full-chart/{user_id}` - Рассчитать полную натальную карту
- `POST /api/natal-chart/calculate/` - Рассчитать натальную карту
- `GET /api/natal-chart/` - Получить натальную карту
- `POST /api/natal-chart/recalculate/` - Пересчитать натальную карту

#### Транзиты и календари (регистры):
- `GET /registers/transits/calendar/{user_id}/{year}/{month}` - Календарь транзитов на месяц (из регистра)
- `GET /registers/transits/daily/{user_id}/{date}` - Детальные транзиты на день (из регистра)
- `POST /registers/transits` - Создать транзит
- `GET /registers/transits` - Список транзитов
- `GET /registers/transits/{transit_id}` - Получить транзит

#### Гостевые расчеты:
- `POST /api/guest/calculate-chart` - Рассчитать карту для гостя (без регистрации)

### 5. Геокодирование
**Работа с геолокацией: поиск городов, определение координат**

- `POST /api/geocoding/search` - Поиск города
- `POST /api/geocoding/manual-coordinates` - Указать координаты вручную
- `GET /api/geocoding/timezone` - Получить временную зону по координатам

### 6. ИИ и контекст
**ИИ-астролог и контекстная информация: чат с ИИ, события, аналитика**

#### ИИ-астролог:
- `GET /ai/templates` - Доступные шаблоны ИИ
- `POST /ai/chat` - Отправить сообщение ИИ-астрологу
- `GET /ai/sessions/{user_id}` - Сессии чата пользователя

#### Контекстные записи:
- `GET /api/v1/context/sessions/{user_id}/active` - Получить активную сессию
- `POST /api/v1/context/sessions/{user_id}/create` - Создать новую сессию
- `POST /api/v1/context/save` - Сохранить контекстную запись
- `GET /api/v1/context/relevant` - Получить релевантный контекст
- `GET /api/v1/context/entries/{user_id}` - Список контекстных записей

#### События (регистры):
- `POST /registers/events` - Создать событие
- `GET /registers/events/{event_id}` - Получить событие
- `PUT /registers/events/{event_id}` - Обновить событие
- `DELETE /registers/events/{event_id}` - Удалить событие

#### Контекстные запросы:
- `POST /registers/context/query` - Выполнить контекстный запрос (комплексный анализ)

## Навигация в Swagger UI

1. Откройте `http://localhost:8000/docs`
2. Используйте выпадающий список тегов вверху для фильтрации
3. Или прокрутите страницу вниз до нужной группы
4. Раскройте нужный endpoint для просмотра деталей

## Преимущества новой структуры

✅ **Логическая группировка** - связанные endpoints находятся рядом  
✅ **Удобный поиск** - легко найти нужный функционал  
✅ **Понятная навигация** - четкое разделение по областям  
✅ **Масштабируемость** - легко добавлять новые группы  

## Миграция со старой структуры

Старые теги были заменены на новые логические группы:

| Старый тег | Новый тег |
|------------|-----------|
| Authentication | Пользователь |
| Users | Пользователь |
| Contacts | Контакты |
| Astrology | Астрологические метрики |
| Natal Charts | Астрологические метрики |
| Guest | Астрологические метрики |
| Geocoding | Геокодирование |
| AI | ИИ и контекст |
| Context | ИИ и контекст |
| Registers | Разделены по группам |

## Рекомендации по использованию

- **Для работы с пользователями** → группа "Пользователь"
- **Для работы с контактами** → группа "Контакты"
- **Для астрологических расчетов** → группа "Астрологические метрики"
- **Для геолокации** → группа "Геокодирование"
- **Для ИИ и аналитики** → группа "ИИ и контекст"

